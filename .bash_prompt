#!/bin/bash

if [[ "$TERM" = xterm-*color ]] ||  [[ "$TERM" = screen ]]; then
    alias ls='ls -G'
    alias grep='grep --color=auto'
    export GREP_COLOR=32 # nice green!

    # Less Colors for Man Pages
    man () {
      (
        export LESS_TERMCAP_mb=$'\e[01;31m'       # begin blinking
        export LESS_TERMCAP_md=$'\e[01;38;5;74m'  # begin bold
        export LESS_TERMCAP_me=$'\e[0m'           # end mode
        export LESS_TERMCAP_se=$'\e[0m'           # end standout-mode
        export LESS_TERMCAP_so=$'\e[38;5;246m'    # begin standout-mode - info box
        export LESS_TERMCAP_ue=$'\e[0m'           # end underline
        export LESS_TERMCAP_us=$'\e[04;38;5;146m' # begin underline
        $(which man) "$@"
      )
    }

    case $TERM in
      xterm*)
        TITLEBAR='\[\033]0;\h:\w\007\]'
        ;;
      *)
        TITLEBAR=""
        ;;
    esac
    
    PS1="${TITLEBAR}\[\033[1;30m\]╭╶ \[\033[01;33m\]\u@\h\[\033[00m\]:\[\033[01;34m\]\$(parse_branch)\[\033[01;31m\]\$(parse_aws_profile)\[\033[01;36m\]\w\[\033[0m\]\n\[\033[1;30m\]╰╶➤ \[\033[0m\] "

    parse_aws_profile() {
      [ -n "$AWS_DEFAULT_PROFILE" ] && echo "AWS($AWS_DEFAULT_PROFILE)"
    }

    parse_branch() {
       parse_svn_branch && parse_git_branch
    }

    parse_svn_branch() {
       (head -5 .svn/entries | tail -1 | sed 's!'`head -6 .svn/entries|tail -1`'!!') 2>/dev/null | sed -e 's/\/\(.*\)/SVN(\1)/'
    }

    parse_git_branch() {
       git branch --no-color 2> /dev/null | sed -e '/^[^*]/d' -e 's/* \(.*\)/GIT(\1)/'
    }
fi
